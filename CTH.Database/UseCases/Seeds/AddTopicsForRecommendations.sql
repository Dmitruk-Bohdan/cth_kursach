-- Скрипт для добавления трех новых тем по русскому языку для проверки логики рекомендаций
-- Добавляет темы: Предлоги и приставки, Слитное и раздельное написание, Определение рода слов
-- По 5 заданий для каждой темы

DO $$
DECLARE
    v_topic_pref BIGINT;  -- Предлоги и приставки
    v_topic_spell BIGINT; -- Слитное и раздельное написание
    v_topic_gender BIGINT; -- Определение рода слов
BEGIN
    -- 1. Создаем новые темы
    INSERT INTO topic (subject_id, topic_name, topic_code, is_active)
    VALUES
        (1, 'Предлоги и приставки', 'PREP_PREF', TRUE),
        (1, 'Слитное и раздельное написание', 'SPELL', TRUE),
        (1, 'Определение рода слов', 'GENDER', TRUE)
    ON CONFLICT DO NOTHING;

    -- Получаем ID созданных тем
    SELECT id INTO v_topic_pref FROM topic WHERE topic_code = 'PREP_PREF' AND subject_id = 1 LIMIT 1;
    SELECT id INTO v_topic_spell FROM topic WHERE topic_code = 'SPELL' AND subject_id = 1 LIMIT 1;
    SELECT id INTO v_topic_gender FROM topic WHERE topic_code = 'GENDER' AND subject_id = 1 LIMIT 1;

    -- 2. Создаем задания для темы "Предлоги и приставки" (5 заданий)
    INSERT INTO task_item (subject_id, topic_id, task_type, difficulty, statement, correct_answer, explanation, is_active)
    VALUES
        (1, v_topic_pref, 'multiple_choice', 1, 'Выберите правильный вариант: "прийти" или "прейти"? Варианты: 1) прийти 2) прейти 3) прийти/прейти 4) зависит от контекста', '{"value": "1", "options": ["прийти", "прейти", "прийти/прейти", "зависит от контекста"]}'::jsonb, 'Правильно: прийти (приставка ПРИ означает приближение)', TRUE),
        (1, v_topic_pref, 'multiple_choice', 2, 'Выберите правильный вариант: "прекрасный" или "прикрасный"? Варианты: 1) прекрасный 2) прикрасный 3) прекрасный/прикрасный 4) зависит от контекста', '{"value": "1", "options": ["прекрасный", "прикрасный", "прекрасный/прикрасный", "зависит от контекста"]}'::jsonb, 'Правильно: прекрасный (приставка ПРЕ означает очень)', TRUE),
        (1, v_topic_pref, 'multiple_choice', 1, 'Выберите правильный вариант: "приехать" или "преехать"? Варианты: 1) приехать 2) преехать 3) приехать/преехать 4) зависит от контекста', '{"value": "1", "options": ["приехать", "преехать", "приехать/преехать", "зависит от контекста"]}'::jsonb, 'Правильно: приехать (приставка ПРИ означает приближение)', TRUE),
        (1, v_topic_pref, 'multiple_choice', 3, 'Выберите правильный вариант: "прервать" или "прирвать"? Варианты: 1) прервать 2) прирвать 3) прервать/прирвать 4) зависит от контекста', '{"value": "1", "options": ["прервать", "прирвать", "прервать/прирвать", "зависит от контекста"]}'::jsonb, 'Правильно: прервать (приставка ПРЕ означает прерывание действия)', TRUE),
        (1, v_topic_pref, 'multiple_choice', 2, 'Выберите правильный вариант: "приблизить" или "преблизить"? Варианты: 1) приблизить 2) преблизить 3) приблизить/преблизить 4) зависит от контекста', '{"value": "1", "options": ["приблизить", "преблизить", "приблизить/преблизить", "зависит от контекста"]}'::jsonb, 'Правильно: приблизить (приставка ПРИ означает приближение)', TRUE)
    ON CONFLICT DO NOTHING;

    -- 3. Создаем задания для темы "Слитное и раздельное написание" (5 заданий)
    INSERT INTO task_item (subject_id, topic_id, task_type, difficulty, statement, correct_answer, explanation, is_active)
    VALUES
        (1, v_topic_spell, 'multiple_choice', 1, 'Выберите правильный вариант: "также" или "так же"? Варианты: 1) также 2) так же 3) также/так же 4) зависит от контекста', '{"value": "4", "options": ["также", "так же", "также/так же", "зависит от контекста"]}'::jsonb, 'Зависит от контекста: "также" = и, "так же" = таким же образом', TRUE),
        (1, v_topic_spell, 'multiple_choice', 2, 'Выберите правильный вариант: "чтобы" или "что бы"? Варианты: 1) чтобы 2) что бы 3) чтобы/что бы 4) зависит от контекста', '{"value": "4", "options": ["чтобы", "что бы", "чтобы/что бы", "зависит от контекста"]}'::jsonb, 'Зависит от контекста: "чтобы" = союз, "что бы" = местоимение + частица', TRUE),
        (1, v_topic_spell, 'multiple_choice', 1, 'Выберите правильный вариант: "причем" или "при чем"? Варианты: 1) причем 2) при чем 3) причем/при чем 4) зависит от контекста', '{"value": "4", "options": ["причем", "при чем", "причем/при чем", "зависит от контекста"]}'::jsonb, 'Зависит от контекста: "причем" = союз, "при чем" = предлог + местоимение', TRUE),
        (1, v_topic_spell, 'multiple_choice', 3, 'Выберите правильный вариант: "зато" или "за то"? Варианты: 1) зато 2) за то 3) зато/за то 4) зависит от контекста', '{"value": "4", "options": ["зато", "за то", "зато/за то", "зависит от контекста"]}'::jsonb, 'Зависит от контекста: "зато" = союз, "за то" = предлог + местоимение', TRUE),
        (1, v_topic_spell, 'multiple_choice', 2, 'Выберите правильный вариант: "оттого" или "от того"? Варианты: 1) оттого 2) от того 3) оттого/от того 4) зависит от контекста', '{"value": "4", "options": ["оттого", "от того", "оттого/от того", "зависит от контекста"]}'::jsonb, 'Зависит от контекста: "оттого" = союз, "от того" = предлог + местоимение', TRUE)
    ON CONFLICT DO NOTHING;

    -- 4. Создаем задания для темы "Определение рода слов" (5 заданий)
    INSERT INTO task_item (subject_id, topic_id, task_type, difficulty, statement, correct_answer, explanation, is_active)
    VALUES
        (1, v_topic_gender, 'multiple_choice', 1, 'Определите род слова "кофе". Варианты: 1) мужской 2) женский 3) средний 4) общего рода', '{"value": "1", "options": ["мужской", "женский", "средний", "общего рода"]}'::jsonb, 'Правильно: мужской род (кофе - он, мой)', TRUE),
        (1, v_topic_gender, 'multiple_choice', 2, 'Определите род слова "тюль". Варианты: 1) мужской 2) женский 3) средний 4) общего рода', '{"value": "1", "options": ["мужской", "женский", "средний", "общего рода"]}'::jsonb, 'Правильно: мужской род (тюль - он, мой)', TRUE),
        (1, v_topic_gender, 'multiple_choice', 1, 'Определите род слова "рояль". Варианты: 1) мужской 2) женский 3) средний 4) общего рода', '{"value": "1", "options": ["мужской", "женский", "средний", "общего рода"]}'::jsonb, 'Правильно: мужской род (рояль - он, мой)', TRUE),
        (1, v_topic_gender, 'multiple_choice', 3, 'Определите род слова "шампунь". Варианты: 1) мужской 2) женский 3) средний 4) общего рода', '{"value": "1", "options": ["мужской", "женский", "средний", "общего рода"]}'::jsonb, 'Правильно: мужской род (шампунь - он, мой)', TRUE),
        (1, v_topic_gender, 'multiple_choice', 2, 'Определите род слова "мозоль". Варианты: 1) мужской 2) женский 3) средний 4) общего рода', '{"value": "2", "options": ["мужской", "женский", "средний", "общего рода"]}'::jsonb, 'Правильно: женский род (мозоль - она, моя)', TRUE)
    ON CONFLICT DO NOTHING;

    RAISE NOTICE 'Topics and tasks created successfully';
END;
$$;

